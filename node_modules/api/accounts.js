import express from "express";
import argon2 from "argon2";
import jwt from "jsonwebtoken";
import mysql from "mysql2/promise";
import dotenv from "dotenv";

dotenv.config();
const router = express.Router();

// MySQL Connection Pool
const db = mysql.createPool({
   host: process.env.DB_HOST,
   user: process.env.DB_USER,
   password: process.env.DB_PASS,
   database: process.env.DB_NAME,
});

// **User Registration**
router.post("/register", async (req, res) => {
const { username, password } = req.body;

try {
    // Check if username already exists
   const [existingUser] = await db.query("SELECT id FROM users WHERE username = ?", [username]);
   if (existingUser.length > 0) return res.status(400).json({ error: "Username already taken" });

    // Hash the password
   const hashedPassword = await argon2.hash(password);

    // Insert user into database
   await db.query("INSERT INTO users (username, password) VALUES (?, ?)", [username, hashedPassword]);

   res.json({ message: "User registered successfully" });
   } catch (err) {
   res.status(500).json({ error: err.message });
   }
});

export default router;
